# 实验三：四位二进制数加法

## 一、实验目的

1.模拟加法器，实现四位二进制数的加法。

2.模拟多选器，实现按钮切换显示模式。

3.熟悉开发板的数码七段码。

---

## 二、实验过程

### 1.加法器ALU

首先代码如下：

<image src="image/3/ALU1.png">

在这里，ALU在具有应有的两个四位输入、一个结果输出的同时，还相应有`CF`进位标志位、`OF`溢出标志位。

<image src="image/3/ALU2.png">

通过模拟一个全加器，实现四位数的加法。同时根据之前所画`ALU`的数字电路图，计算出`CF` `OF`的值。

### 2.多选器MUX

首先代码如下：

<image src="image/3/MUX.png">

这里设计多选器，是为了允许我通过按下选择按钮来选择要显示的内容。选择的媒介是变量`Sel`，最后选择要显示的内容寄存在`Mux_result`里。

之所以输入设置为八位的，是因为为了同时显示两个四位的二进制数，要对其进行连接扩展，即直接以`{Data1, Data2}`的形式输入。

### 3.显示模块

首先代码如下：

<image src="image/3/DISPLAY1.png">

这个模块具有三个输入，一个是要显示的八位数据`Data`，一个是判断显示源操作数还是结果的变量`isResult`，最后一个是时钟以随时更新显示。

还有两个输出，分别是四位位选变量`seg`，对应四个数码显示；七位段选变量`a_to_g`，对应一个数码显示的七段数码管。

`temp`用于记录当前正在计算的位数，并指定位选的位数。`x`用于记录当前计算出的值，并指明位选。

<image src="image/3/DISPLAY2.png">

这一部分用于具体实现计算出要显示的数与位选。数码管是低电平有效，因此以`0`标示要显示的那一位数码。当要显示结果时，直接指定为`Data`的相应位数即可；当要显示源操作数时，高位显示在高位低位显示在低位。

每次使`temp`自增`1`从而使之指定下一位的计算。每到`4`重新计数。

<image src="image/3/DISPLAY3.png">

这一部分是具体的段选。实际就是绘制相应数字在七段码上的显示。

### 4.分频器

首先代码如下：

<image src="image/3/CLK_DIV.png">

由于内置时钟频率太高不适合用于数码管显示，因此使用分频器降频`100000`倍。原理就是使用一个计数器，原时钟每周期计数一次，每计数`100000`次就输出一次信号——或者说，为了契合时钟的特点，就将输出反向一次，从而模拟上升沿与下降沿。

### 5.顶层文件TOP

首先代码如下：

<image src="image/3/TOP1.png">

顶层文件类似C语言的源文件，将各头文件联合在一起。这里，`clk_wire`用于将传输降频后的时钟信号，`Result`用于传出相加的结果，`mux_result`用于传出多选的结果。

<image src="image/3/TOP2.png">

原始时钟接入`CLK_div`模块，传出降频的时钟信号`clk_wire`。

`Display`模块以降频时钟为基准刷新。要显示的内容就是`mux_result`，`display_switch`指示显示模式。`seg` `a_to_g`分别指示位选和段选。

多选器接收两个源操作数的连接扩展、和两者之和的输入。传出两个输出`mux_result` `display_switch`，即是上一个模块`Display`的重要参数。

<image src="image/3/TOP3.png">

当按下左边按钮，切换为显示模式`0`；按下右边按钮，切换为显示模式`1`。

`ALU`模块就是正常的输入两个源操作数，输出结果与溢出、进位标志。

### 6.约束文件

<image src="image/3/CON1.png">

<image src="image/3/CON2.png">

在这里，考虑到八个拨板开关连在一起不好区分，我将第一个操作数设为左边四个拨板、第二个设为右边四个。同时，`CF`设为最右边的LED，`OF`设为最左边的LED。

---

## 三、实验效果

### 1. 8+4=12

以下演示`8+4=12`，即`1000+0100=1100`：

<image src="image/3/8+4.jpg">

<image src="image/3/12.jpg">

此时，正常显示。既没有溢出也没有进位。

### 2. 12+4=16

以下演示`12+4=16`，即`1100+0100=(1) 0000`：

<image src="image/3/12+4.jpg">

<image src="image/3/16.jpg">

此时已发生溢出，应得的`16`显示为`0`，溢出指示灯亮。但次高位没有进位，故进位指示灯不亮。

### 3. 12+8=20

以下演示`12+8=20`，即`1100+1000=(1) 0100`：

<image src="image/3/12+8.jpg">

<image src="image/3/20.jpg">

此时已发生溢出，应得的`20`显示为`4`，溢出指示灯亮。次高位有进位，故进位指示灯亮。

---

## 四、心得体会

在这次实验中，我学到了使用模块化的思想，将每一个部分以独立的模块编写，后期再在顶层文件中统筹。
