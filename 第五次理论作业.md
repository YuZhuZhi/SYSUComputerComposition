# 第五次理论作业

## 一

### 4.1

#### 4.1.1

`RegWrite` `MemRead` `Branch`都为`0`。
`ALUop`为`10` `->` `ADD`。
`MemWrite`为`1`。

#### 4.1.2

除处理分支指令的加法器之外的其它所有单元。

#### 4.1.3

处理分支指令的加法器。

无。

---

### 4.2

#### 4.2.1

指令存储器，寄存器堆，加法器`ALU`，数据存储器。

#### 4.2.2

无需增加。

#### 4.2.3

无需增加。

---

### 4.3

#### 4.3.1

按照用时最长指令`lw`来算，改进前：`400+200+30+120+350+30=1130ps`。
改进后为`1430ps`。

#### 4.3.2

$\dfrac{1130}{1430}\times\dfrac{1}{0.95}=0.8318$

#### 4.3.3

原价$1000+2\times30+3\times10+100+200+2000+500=3890$
改进后为$4490$。

因$\dfrac{3890}{1130}=3.4425>\dfrac{4490}{1430}=3.1399$

虽然每`1ps`成本降低，但是用更多的钱换来更低的性能。

---

### 4.4

#### 4.4.1

`200ps`

#### 4.4.2

`200+15+10+70+20=315ps`

#### 4.4.3

`200+90+20+90+20=420ps`

#### 4.4.4

相对跳转指令。

#### 4.4.5

无条件相对跳转指令。

#### 4.4.6

分支发生时用时`15+10+70=95ps`
分支不发生时用时`90+20+90=200ps`
在该单元延迟低于`10+105=115ps`时对时钟周期无影响。高于时影响。

---

## 三

### 2.23

`slt $t2, $0, $t0`将`$t2`设为`1`。因此`bne`后跳入`ELSE`，`$t2`增加`2`。
因此`$t2`值为`3`。

### 2.25

#### 2.25.1

`I`型指令。

#### 2.25.2

```Shell
addi $t2, $t2, 1
beq $t2, $0, loop
```

## 四

`OF`：即`Overflow Flag`，判断最高位是否产生溢出。是将两个源操作数当成有符号数看时：
若两个正数相加产生负数、或两个负数相加产生正数，则此标志位为`1`。

`SF`：即`Sign Flag`，判断结果的正负。若结果的最高位为`1`则置`1`。只对有符号数有意义。

`CF`：即`Carry Flag`，判断最高位是否产生进位或借位。相当于无符号数的溢出判断。只对无符号数有意义。

`ZF`：即`Zero Flag`，判断结果是否为`0`。若是则置`1`。

下面用`src1` `src2`表示两个源操作数。以`res = src1 - src2`表示结果。

对于有符号数：(1)若`ZF = 1`，那么两数相等;
(2)若`SF = 1`且`OF = 0`，也即结果为负数且不溢出，则`src1 < src2`;
(3)若`SF = 0`且`OF = 0`，也即结果为正数且不溢出，则`src1 > src2`;
(4)若`SF = 1`但`OF = 1`，也即结果为负数但向上溢出，则`src1 > src2`;
(5)若`SF = 0`但`OF = 1`，也即结果为正数但向下溢出，则`src1 < src2`。

对于无符号数：(1)若`ZF = 1`，那么两数相等;
(2)若`CF = 1`，也即结果溢出(最高位借位)，则`src1 < src2`;
(3)若`CF = 0`，也即结果不溢出(最高位不借位)，则`src1 > src2`;

---

## 五

区别仅在于`JG NEXT`和`JA NEXT`一句，分别是有符号大于则跳转及无符号大于则跳转。

第一个程序判断有符号数的`-1 ? 2`，为小于，故`JG NEXT`无效，`DL`设置为`'0'`。之后跳转到`EXIT`，输出为`'0'`。

寄存器：`AL = -1` `ZF = 0` `SF = 1` `OF = 0` `DL = '0'` `AH = 4CH`

下面三张图是代码截图、运行截图、寄存器截图：

<image src="image/5.t/JG1CODE.png">

<image src="image/5.t/JG1RES.png">

<image src="image/5.t/JG1DEBUG.png">

由寄存器截图，`ZF` `SF` `OF`标志位分别是`NZ` `NG` `NV`，对应上述。

第二个程序判断无符号数的`-1 ? 2`，为大于，故`JG NEXT`有效，`DL`设置为`'1'`。之后跳转到`EXIT`，输出为`'1'`。

寄存器：`AL = -1` `ZF = 0` `CF = 0` `DL = '0'` `AH = 4CH`

下面三张图是代码截图、运行截图、寄存器截图：

<image src="image/5.t/JA1CODE.png">

<image src="image/5.t/JA1RES.png">

<image src="image/5.t/JA1DEBUG.png">

由寄存器截图，`ZF` `CF`标志位分别是`NZ` `NC`，对应上述。

---

## 六

对第一个程序，`MIPS`汇编改写如下：

<image src="image/5.t/JG1M.jpg">

运行结果为`0`，如下：

<image src="image/5.t/JG1MR.jpg">

对第二个程序，`MIPS`汇编改写如下：

<image src="image/5.t/JA1M.jpg">

运行结果为`1`，如下：

<image src="image/5.t/JA1MR.jpg">
